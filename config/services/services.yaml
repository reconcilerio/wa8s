---
apiVersion: wa8s.reconciler.io/v1alpha1
kind: ConfigStore
metadata:
  name: services-webhook-config
spec:
  values:
  - name: host
    # TODO parameterize
    value: webhook-service.wa8s-system.svc.cluster.local
  - name: scheme
    # TODO use https with a custom ca
    value: http

---
apiVersion: wa8s.reconciler.io/v1alpha1
kind: Composition
metadata:
  name: services-ids
spec:
  dependencies:
  - component: componentized:services-ids
    oci:
      image: ghcr.io/componentized/services/webhook-ids:v0.0.2@sha256:d5e40e3268ccca10a254282aba1283311fb48721a4c157ff13b93c3cbd5d92ef
  - component: componentized:webhook-config
    ref:
      kind: ConfigStore
      name: services-webhook-config

---
apiVersion: wa8s.reconciler.io/v1alpha1
kind: ClusterComponent
metadata:
  name: wa8s-services-ids
spec:
  ref:
    kind: Composition
    # TODO set namespace via kustomize
    namespace: wa8s-system
    name: services-ids

---
apiVersion: wa8s.reconciler.io/v1alpha1
kind: Composition
metadata:
  name: services-credential-admin
spec:
  dependencies:
  - component: componentized:services-credential-admin
    oci:
      image: ghcr.io/componentized/services/webhook-credential-admin:v0.0.2@sha256:81a486b9fe9aa36eb94e0123c15da7d3521f01996d2dd19aba447a15e393cf8d
  - component: componentized:webhook-config
    ref:
      kind: ConfigStore
      name: services-webhook-config

---
apiVersion: wa8s.reconciler.io/v1alpha1
kind: ClusterComponent
metadata:
  name: wa8s-services-credential-admin
spec:
  ref:
    kind: Composition
    # TODO set namespace via kustomize
    namespace: wa8s-system
    name: services-credential-admin

---
apiVersion: wa8s.reconciler.io/v1alpha1
kind: Composition
metadata:
  name: services-credential-store
spec:
  dependencies:
  - component: componentized:services-credential-store
    oci:
      image: ghcr.io/componentized/services/webhook-credential-store:v0.0.2@sha256:c0bea28c25cf67235f6519e32ed044f0fd19e85b01e57e08101a0eabd731188f
  - component: componentized:webhook-config
    ref:
      kind: ConfigStore
      name: services-webhook-config

---
apiVersion: wa8s.reconciler.io/v1alpha1
kind: ClusterComponent
metadata:
  name: wa8s-services-credential-store
spec:
  ref:
    kind: Composition
    # TODO set namespace via kustomize
    namespace: wa8s-system
    name: services-credential-store

---
apiVersion: wa8s.reconciler.io/v1alpha1
kind: ClusterComponent
metadata:
  name: wa8s-services-credential-config
spec:
  oci:
    image: ghcr.io/componentized/services/credential-config:v0.0.2@sha256:3ad249f02f6dc3683bba446bd4f3e107ec6027c1e4ad00128f3616bbbf02a56b
    serviceAccountRef:
      # TODO set namespace via kustomize
      namespace: wa8s-system
      name: default

---
apiVersion: wa8s.reconciler.io/v1alpha1
kind: ClusterComponent
metadata:
  name: wa8s-services-lifecycle-host-http
spec:
  oci:
    image: ghcr.io/componentized/services/lifecycle-host-http:v0.0.2@sha256:b7e0c8f953a207bda5c1aa31d7f7c0d21867b03f10d030f135710cb404e6a4ca
    serviceAccountRef:
      # TODO set namespace via kustomize
      namespace: wa8s-system
      name: default

---
apiVersion: wa8s.reconciler.io/v1alpha1
kind: ClusterComponent
metadata:
  name: wa8s-services-logging
spec:
  oci:
    image: ghcr.io/componentized/logging/to-stdout:v0.1.0@sha256:28d0f577e81c2e32ab6a757ad636751de28331cd7d435b02f048ab3bf3b4ac1c
    serviceAccountRef:
      # TODO set namespace via kustomize
      namespace: wa8s-system
      name: default
